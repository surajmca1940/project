<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking System Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card { 
            background: white; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status { 
            padding: 10px; 
            border-radius: 4px; 
            margin: 10px 0; 
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .test-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        iframe { width: 100%; height: 600px; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>üß™ Booking System Test & Debug</h1>
    
    <div class="test-card">
        <h2>Server Status</h2>
        <div id="server-status" class="status info">Checking server...</div>
        <button onclick="checkServer()">Refresh Server Status</button>
    </div>
    
    <div class="test-card">
        <h2>Booking Page Tests</h2>
        <div id="booking-tests">
            <div class="status info">Running tests...</div>
        </div>
        <button onclick="runBookingTests()">Run All Tests</button>
        <button onclick="openBookingPage()">Open Booking Page</button>
    </div>
    
    <div class="test-grid">
        <div class="test-card">
            <h3>Quick Actions</h3>
            <button onclick="testStep1()">Test Step 1 (Counselors)</button>
            <button onclick="testStep2()">Test Step 2 (Date/Time)</button>
            <button onclick="testStep3()">Test Step 3 (Details)</button>
            <button onclick="testStep4()">Test Step 4 (Confirm)</button>
            <button onclick="testFullFlow()">Test Full Flow</button>
        </div>
        
        <div class="test-card">
            <h3>Debug Tools</h3>
            <button onclick="checkJavaScript()">Check JavaScript Load</button>
            <button onclick="checkCSS()">Check CSS Load</button>
            <button onclick="checkElements()">Check DOM Elements</button>
            <button onclick="clearCache()">Clear Browser Cache</button>
        </div>
    </div>
    
    <div class="test-card">
        <h2>Live Booking Preview</h2>
        <iframe id="booking-frame" src="http://127.0.0.1:8000/booking/"></iframe>
        <button onclick="reloadFrame()">Reload Booking Page</button>
    </div>
    
    <div class="test-card">
        <h2>Console Logs</h2>
        <div id="console-logs" style="background: #f8f9fa; padding: 15px; border-radius: 4px; font-family: monospace; max-height: 300px; overflow-y: auto;">
            <div>Waiting for logs...</div>
        </div>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>

    <script>
        // Logging system
        const logs = document.getElementById('console-logs');
        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const logDiv = document.createElement('div');
            logDiv.style.color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#6c757d';
            logDiv.textContent = `[${time}] ${message}`;
            logs.appendChild(logDiv);
            logs.scrollTop = logs.scrollHeight;
        }
        
        // Override console methods to capture logs
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            addLog(args.join(' '), 'info');
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addLog(args.join(' '), 'error');
            originalError.apply(console, args);
        };
        
        function clearLogs() {
            logs.innerHTML = '<div>Logs cleared...</div>';
        }
        
        // Server status check
        async function checkServer() {
            const statusDiv = document.getElementById('server-status');
            try {
                const response = await fetch('http://127.0.0.1:8000/');
                if (response.ok) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ Server is running on http://127.0.0.1:8000/';
                    addLog('Server status: OK', 'success');
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå Server responded with error: ' + response.status;
                    addLog('Server error: ' + response.status, 'error');
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Cannot connect to server: ' + error.message;
                addLog('Server connection failed: ' + error.message, 'error');
            }
        }
        
        // Booking tests
        async function runBookingTests() {
            const testsDiv = document.getElementById('booking-tests');
            testsDiv.innerHTML = '<div class="status info">Running tests...</div>';
            
            const tests = [
                { name: 'Booking page loads', test: testBookingPageLoad },
                { name: 'JavaScript files load', test: testJavaScriptLoad },
                { name: 'CSS files load', test: testCSSLoad },
                { name: 'DOM elements exist', test: testDOMElements }
            ];
            
            for (const test of tests) {
                try {
                    const result = await test.test();
                    const div = document.createElement('div');
                    div.className = result ? 'status success' : 'status error';
                    div.textContent = `${result ? '‚úÖ' : '‚ùå'} ${test.name}`;
                    testsDiv.appendChild(div);
                    addLog(`Test: ${test.name} - ${result ? 'PASSED' : 'FAILED'}`, result ? 'success' : 'error');
                } catch (error) {
                    const div = document.createElement('div');
                    div.className = 'status error';
                    div.textContent = `‚ùå ${test.name} - Error: ${error.message}`;
                    testsDiv.appendChild(div);
                    addLog(`Test: ${test.name} - ERROR: ${error.message}`, 'error');
                }
            }
        }
        
        async function testBookingPageLoad() {
            const response = await fetch('http://127.0.0.1:8000/booking/');
            return response.ok;
        }
        
        async function testJavaScriptLoad() {
            const response = await fetch('http://127.0.0.1:8000/static/js/booking-simple.js');
            return response.ok;
        }
        
        async function testCSSLoad() {
            const response = await fetch('http://127.0.0.1:8000/static/css/style.css');
            return response.ok;
        }
        
        async function testDOMElements() {
            const response = await fetch('http://127.0.0.1:8000/booking/');
            const html = await response.text();
            const hasSteps = html.includes('step-1') && html.includes('step-2') && html.includes('step-3') && html.includes('step-4');
            const hasButtons = html.includes('btn-next') && html.includes('btn-prev') && html.includes('btn-confirm');
            const hasCounselors = html.includes('counselor-card');
            const hasTimeSlots = html.includes('time-slot');
            
            return hasSteps && hasButtons && hasCounselors && hasTimeSlots;
        }
        
        function openBookingPage() {
            window.open('http://127.0.0.1:8000/booking/', '_blank');
            addLog('Opened booking page in new tab', 'info');
        }
        
        function reloadFrame() {
            document.getElementById('booking-frame').src = 'http://127.0.0.1:8000/booking/?' + Date.now();
            addLog('Reloaded booking frame', 'info');
        }
        
        // Test functions
        function testStep1() {
            addLog('Testing Step 1: Counselor selection', 'info');
            alert('1. Go to booking page\n2. Click on any counselor card\n3. Should highlight and auto-advance to Step 2');
        }
        
        function testStep2() {
            addLog('Testing Step 2: Date and time selection', 'info');
            alert('1. Complete Step 1 first\n2. Select a date from calendar\n3. Click on any available time slot\n4. Next button should become enabled');
        }
        
        function testStep3() {
            addLog('Testing Step 3: Personal details', 'info');
            alert('1. Complete Steps 1-2 first\n2. Fill in optional details\n3. Select concern tags\n4. Choose privacy preference');
        }
        
        function testStep4() {
            addLog('Testing Step 4: Confirmation', 'info');
            alert('1. Complete Steps 1-3 first\n2. Review appointment details\n3. Click "Confirm Booking"\n4. Should show success page');
        }
        
        function testFullFlow() {
            addLog('Testing full booking flow', 'info');
            alert('Full Flow Test:\n1. Select counselor (auto-advances)\n2. Pick date and time\n3. Fill optional details\n4. Confirm booking\n5. See success page');
        }
        
        function checkJavaScript() {
            fetch('http://127.0.0.1:8000/static/js/booking-simple.js')
                .then(response => {
                    if (response.ok) {
                        addLog('‚úÖ JavaScript file loads successfully', 'success');
                    } else {
                        addLog('‚ùå JavaScript file failed to load', 'error');
                    }
                })
                .catch(error => {
                    addLog('‚ùå JavaScript load error: ' + error.message, 'error');
                });
        }
        
        function checkCSS() {
            fetch('http://127.0.0.1:8000/static/css/style.css')
                .then(response => {
                    if (response.ok) {
                        addLog('‚úÖ CSS file loads successfully', 'success');
                    } else {
                        addLog('‚ùå CSS file failed to load', 'error');
                    }
                })
                .catch(error => {
                    addLog('‚ùå CSS load error: ' + error.message, 'error');
                });
        }
        
        function checkElements() {
            fetch('http://127.0.0.1:8000/booking/')
                .then(response => response.text())
                .then(html => {
                    const elements = {
                        'Step 1': html.includes('step-1'),
                        'Step 2': html.includes('step-2'),
                        'Step 3': html.includes('step-3'),
                        'Step 4': html.includes('step-4'),
                        'Next Button': html.includes('btn-next'),
                        'Previous Button': html.includes('btn-prev'),
                        'Confirm Button': html.includes('btn-confirm'),
                        'Counselor Cards': html.includes('counselor-card'),
                        'Time Slots': html.includes('time-slot'),
                        'Calendar Grid': html.includes('calendar-grid')
                    };
                    
                    Object.entries(elements).forEach(([name, exists]) => {
                        addLog(`${exists ? '‚úÖ' : '‚ùå'} ${name}: ${exists ? 'Found' : 'Missing'}`, exists ? 'success' : 'error');
                    });
                })
                .catch(error => {
                    addLog('‚ùå Element check error: ' + error.message, 'error');
                });
        }
        
        function clearCache() {
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            
            // Force reload frame without cache
            const frame = document.getElementById('booking-frame');
            frame.src = 'http://127.0.0.1:8000/booking/?' + Date.now();
            
            addLog('Cache cleared and page reloaded', 'info');
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üß™ Booking Test System initialized', 'success');
            checkServer();
            
            // Auto-run basic tests
            setTimeout(runBookingTests, 1000);
        });
    </script>
</body>
</html>